# wellknown

A toolkit from **airnub-labs** for building production-ready `/.well-known/*`
endpoints.

> For complete configuration details, Linkset examples, and AI workflow docs,
> see [`packages/api-catalog/README.md`](./packages/api-catalog/README.md).

## Why this exists (AI LLM / coding agents)

LLM-powered agents increasingly call live APIs, but today they usually depend on
hand-curated OpenAPI URLs, plugin manifests, or scattered documentation. Those
artifacts fall out of sync quickly, forcing humans (or agents) to guess which
spec is current, scrape portals, or maintain brittle allowlists.

RFC 9727 changes that story by standardising `/.well-known/api-catalog`. When a
host publishes a Linkset JSON catalog at that location, any agent can:

1. `GET /.well-known/api-catalog`
2. Parse the `linkset` array (each entry is an API anchor)
3. Follow `service-desc` links to live OpenAPI, GraphQL SDL, AsyncAPI, or JSON
   Schema documents
4. Use those specs to generate clients, validate prompts, or drive toolchains
   against the real infrastructure

wellknown packages automate that publication step so agents—and your own SDKs—can
always discover the canonical source of truth straight from production.

## Standards

- **RFC 9727** – defines `/.well-known/api-catalog`, the `api-catalog` link
  relation, and the requirement to advertise catalogs with the
  `https://www.rfc-editor.org/info/rfc9727` profile
- **RFC 9264** – describes Linkset JSON (`application/linkset+json`), the payload
  format emitted by this repo
- **RFC 8631** – lists the service link relations (`service-desc`, `service-doc`,
  `service-meta`, `status`) that connect anchors to specs, docs, and metadata
- **RFC 7239** – details the `Forwarded` header used to safely reconstruct the
  externally-visible origin even when you sit behind proxies or CDNs

## Packages

- [`@airnub/wellknown-api-catalog`](./packages/api-catalog) – publish Linkset
  JSON catalogs plus drop-in handlers for Express and Fastify so your
  `/.well-known/api-catalog` endpoint is spec-aligned and proxy-safe by default

## Quickstart: API catalog

```ts
import type { ApiCatalogConfig } from '@airnub/wellknown-api-catalog';
import {
  createExpressApiCatalogHandler,
  createExpressApiCatalogHeadHandler,
  registerFastifyApiCatalog,
  openApiSpec,
  graphqlSchemaSpec,
} from '@airnub/wellknown-api-catalog';
import express from 'express';
import Fastify from 'fastify';

export const catalogConfig: ApiCatalogConfig = {
  publisher: 'airnub-labs',
  originStrategy: { kind: 'fromRequest', trustProxy: false },
  apis: [
    {
      id: 'rotation-detector',
      title: 'Institutional Rotation Detector API',
      basePath: '/apis/rotation',
      specs: [
        openApiSpec('/apis/rotation/openapi.json', '3.1'),
        {
          rel: 'service-doc',
          href: 'https://docs.airnub.dev/rotation',
          type: 'text/html',
          title: 'HTML docs',
        },
      ],
    },
    {
      id: 'unusual-whales-proxy',
      title: 'Unusual Whales Proxy API',
      basePath: '/apis/unw',
      specs: [graphqlSchemaSpec('/apis/unw/schema.graphql')],
    },
  ],
};

const app = express();
const fastify = Fastify();

// Express
app.get('/.well-known/api-catalog', createExpressApiCatalogHandler(catalogConfig));
app.head('/.well-known/api-catalog', createExpressApiCatalogHeadHandler(catalogConfig));

// Fastify
registerFastifyApiCatalog(fastify, catalogConfig);
```

The handlers emit `application/linkset+json; profile="https://www.rfc-editor.org/info/rfc9727"`,
return the catalog payload generated by `buildApiCatalogLinkset`, and ensure HEAD
responses mirror GET headers (Content-Type + `rel="api-catalog"`).

## Development

```bash
pnpm install
pnpm lint
pnpm test
pnpm build
```

Each command runs across all workspaces so new packages automatically opt in.

## Publishing to npm

The `@airnub/wellknown-api-catalog` package is published to the public npm
registry.

Releases are done via a manually triggered GitHub Actions workflow:

1. Bump the version in `packages/api-catalog/package.json` using SemVer.
2. Commit and push the change to `main`.
3. Go to **Actions → Publish @airnub/wellknown-api-catalog** and click **Run workflow**.
4. The workflow will build, test, and publish to npm using the `NPM_TOKEN` secret.

For detailed steps and credential setup, see
[`docs/publishing-npm.md`](./docs/publishing-npm.md).
