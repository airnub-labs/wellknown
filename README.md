# wellknown

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](./LICENSE)
[![npm version](https://img.shields.io/npm/v/@airnub/wellknown-api-catalog.svg)](https://www.npmjs.com/package/@airnub/wellknown-api-catalog)
[![npm downloads](https://img.shields.io/npm/dm/@airnub/wellknown-api-catalog.svg)](https://www.npmjs.com/package/@airnub/wellknown-api-catalog)
[![CI](https://github.com/airnub-labs/wellknown/actions/workflows/ci.yml/badge.svg)](https://github.com/airnub-labs/wellknown/actions/workflows/ci.yml)
[![Docs](https://img.shields.io/badge/docs-GitHub%20Pages-blue)](https://airnub-labs.github.io/wellknown/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.5-blue.svg)](https://www.typescriptlang.org/)

A toolkit from **Airnub Technologies Limited** for building production-ready `/.well-known/*`
endpoints.

> For complete configuration details, Linkset examples, and AI workflow docs,
> see [`packages/api-catalog/README.md`](./packages/api-catalog/README.md).

## Why this exists (AI LLM / coding agents)

LLM-powered agents increasingly call live APIs, but today they usually depend on
hand-curated OpenAPI URLs, plugin manifests, or scattered documentation. Those
artifacts fall out of sync quickly, forcing humans (or agents) to guess which
spec is current, scrape portals, or maintain brittle allowlists.

RFC 9727 changes that story by standardising `/.well-known/api-catalog`. When a
host publishes a Linkset JSON catalog at that location, any agent can:

1. `GET /.well-known/api-catalog`
2. Parse the `linkset` array (each entry is an API anchor)
3. Follow `service-desc` links to live OpenAPI, GraphQL SDL, AsyncAPI, or JSON
   Schema documents
4. Use those specs to generate clients, validate prompts, or drive toolchains
   against the real infrastructure

wellknown packages automate that publication step so agents—and your own SDKs—can
always discover the canonical source of truth straight from production.

## Standards

- **RFC 9727** – defines `/.well-known/api-catalog`, the `api-catalog` link
  relation, and the requirement to advertise catalogs with the
  `https://www.rfc-editor.org/info/rfc9727` profile
- **RFC 9264** – describes Linkset JSON (`application/linkset+json`), the payload
  format emitted by this repo
- **RFC 8631** – lists the service link relations (`service-desc`, `service-doc`,
  `service-meta`, `status`) that connect anchors to specs, docs, and metadata
- **RFC 7239** – details the `Forwarded` header used to safely reconstruct the
  externally-visible origin even when you sit behind proxies or CDNs

## Packages

- [`@airnub/wellknown-api-catalog`](./packages/api-catalog) – publish Linkset
  JSON catalogs plus drop-in handlers for Express and Fastify so your
  `/.well-known/api-catalog` endpoint is spec-aligned and proxy-safe by default

## Quickstart: API catalog

```ts
import type { ApiCatalogConfig } from '@airnub/wellknown-api-catalog';
import {
  createExpressApiCatalogHandler,
  createExpressApiCatalogHeadHandler,
  fastifyApiCatalogPlugin,
  openApiSpec,
  graphqlSchemaSpec,
} from '@airnub/wellknown-api-catalog';
import express from 'express';
import Fastify from 'fastify';

export const catalogConfig: ApiCatalogConfig = {
  publisher: 'example-publisher',
  originStrategy: { kind: 'fromRequest', trustProxy: false },
  apis: [
    {
      id: 'example-service-one',
      title: 'Example Service One API',
      basePath: '/apis/service-one',
      specs: [
        openApiSpec('/apis/service-one/openapi.json', '3.1'),
        {
          rel: 'service-doc',
          href: 'https://docs.example.com/service-one',
          type: 'text/html',
          title: 'HTML docs',
        },
      ],
    },
    {
      id: 'example-service-two',
      title: 'Example Service Two API',
      basePath: '/apis/service-two',
      specs: [graphqlSchemaSpec('/apis/service-two/schema.graphql')],
    },
  ],
};

const app = express();
const fastify = Fastify();

// Express
app.get('/.well-known/api-catalog', createExpressApiCatalogHandler(catalogConfig));
app.head('/.well-known/api-catalog', createExpressApiCatalogHeadHandler(catalogConfig));

// Fastify
fastify.register(fastifyApiCatalogPlugin, { config: catalogConfig });
```

The handlers emit `application/linkset+json; profile="https://www.rfc-editor.org/info/rfc9727"`,
return the catalog payload generated by `buildApiCatalogLinkset`, and ensure HEAD
responses mirror GET headers (Content-Type + `rel="api-catalog"`).

### Serverless and edge runtimes

If you're deploying via the Next.js App Router or Supabase Edge Functions, derive
the origin from `request.url` and feed it to
`buildApiCatalogLinksetForOrigin(catalogConfig, origin)`. The helper is entirely
framework-agnostic, so it works in Edge (Fetch API) runtimes without referencing
Node's `IncomingMessage`. Full examples live in
[`docs/index.md`](./docs/index.md).

## Development

```bash
pnpm install
pnpm lint
pnpm test
pnpm build
```

Each command runs across all workspaces so new packages automatically opt in.

## Documentation

Full documentation is published to GitHub Pages:

https://airnub-labs.github.io/wellknown/

The docs are generated from the `docs/` directory and built at CI time using a
temporary Docusaurus project (no Docusaurus config or dependencies are checked
into this repo).

## Publishing to npm

The `@airnub/wellknown-api-catalog` package is published to the public npm
registry. The package is currently in pre-release (`0.1.0-next.x`). Install via
the `next` tag until the first stable release:

```bash
pnpm add @airnub/wellknown-api-catalog@next
# or
npm install @airnub/wellknown-api-catalog@next
```

Releases are done via a manually triggered GitHub Actions workflow:

1. Bump the version in `packages/api-catalog/package.json` using SemVer.
2. Commit and push the change to `main`.
3. Go to **Actions → Publish @airnub/wellknown-api-catalog** and click **Run workflow**.
4. The workflow will build, test, and publish to npm using the `NPM_TOKEN` secret.

For detailed steps and credential setup, see
[`docs/publishing-npm.md`](./docs/publishing-npm.md).

---

## License

Copyright © 2024-2025 Airnub Technologies Limited

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
